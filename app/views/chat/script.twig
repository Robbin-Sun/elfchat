<script src="{{ asset('lib/vendors.js') }}"></script>
<script src="{{ asset('app.js') }}"></script>
<script src="{{ asset('emotion/catalog.js') }}"></script>
<script src="{{ asset('emotion/list.js') }}"></script>
<script type="text/javascript">
    // Config
    {% autoescape false %}
    window.config = {
        server: {
            type: '{{ app.config.get('server.type') }}',
            host: '{{ app.config.get('server.host') }}',
            port: {{ app.config.get('server.port') }},
            interval: {{ app.config.get('server.interval') }}
        },
        sound: {
            message: '{{ app.request.basePath }}/web/lib/media/sound/beep.mp3',
            join: '{{ app.request.basePath }}/web/lib/media/sound/online.mp3'
        }
    };
    {% endautoescape %}

    // User
    {% autoescape false %}
    window.user = {{ user|json_encode() }};
    {% endautoescape %}

    // Recent messages
    window.recent = {{ recent|json_encode|raw }};

    // Translation
    window.lang = {{ lang|json_encode|raw }};

    // Application
    $(function () {
        {% if app.config.get('server.type') == 'ajax' %}
        window.server = new AjaxServer({
            poll: '{{ url('ajax_poll') }}',
            send: '{{ url('ajax_send') }}'
        }, window.config.server.interval);
        {% else %}
        window.server = new WebSocketServer(window.config.server.host, window.config.server.port);
        {% endif %}
        window.scroll = new Scroll($('#chat'));
        window.sound = new Sound();
        window.notify = new Notify();
        window.sound = new Sound();
        window.users = new Users();
        window.emotion = new Emotion();
        window.chat = new Application(window.server);
        window.chat.run();
    });
</script>

{# Views #}
{% autoescape false %}
{{ view('chat/tab/user.view') }}
{{ view('chat/board/log.view') }}
{{ view('chat/board/message.view') }}
{{ view('chat/emotion/tab.view') }}
{{ view('chat/emotion/image.view') }}
{{ view('chat/popover/profile.view') }}
{% endautoescape %}

{# Popovers #}
{% include 'chat/popover/emotion.twig' %}
{% include 'chat/popover/settings.twig' %}
{% include 'chat/popover/bbcode.twig' %}

