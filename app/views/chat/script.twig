<script src="{{ asset('lib/vendors.js') }}"></script>
<script src="{{ asset('app.js') }}"></script>
<script src="{{ asset('emotion/catalog.js') }}"></script>
<script src="{{ asset('emotion/list.js') }}"></script>
<script src="{{ app.config.server }}/socket.io/socket.io.js"></script>
<script type="text/javascript">
    // Config
    {% autoescape false %}
    window.config = {
        server: '{{ app.config.server }}',
        namespace: '{{ app.config.domain }}',
        domain: '{{ app.config.domain }}',
        auth: {{ save|json_encode() }},
        api: {
            send: '{{ url('send') }}'
        },
        sound: {
            message: '{{ app.request.basePath }}/web/lib/media/sound/beep.mp3',
            join: '{{ app.request.basePath }}/web/lib/media/sound/online.mp3'
        }
    };
    {% endautoescape %}

    // User
    {% autoescape false %}
    window.user = {{ save.user|json_encode() }};
    {% endautoescape %}

    // Recent messages
    window.recent = {{ recent|json_encode|raw }};

    // Translation
    window.lang = {{ lang|json_encode|raw }};

    // Room
    window.room = 'main';

    // Application
    $(function () {
        try {
            window.notify = new Notify();
            window.sound = new Sound();
            window.tabs = new Tabs();
            window.emotion = new Emotion();
            window.chat = new Application();
            window.chat.run();
        } catch (e) {
            notify.error(tr(e.message));
        }
    });
</script>

{# Views #}
{% autoescape false %}
{{ view('chat/tab/room.view') }}
{{ view('chat/tab/user.view') }}
{{ view('chat/board/log.view') }}
{{ view('chat/board/message.view') }}
{{ view('chat/board/spirit.view') }}
{{ view('chat/board/chat.view') }}
{{ view('chat/emotion/tab.view') }}
{{ view('chat/emotion/image.view') }}
{{ view('chat/popover/profile.view') }}
{% endautoescape %}

{# Popovers #}
{% include 'chat/popover/emotion.twig' %}
{% include 'chat/popover/settings.twig' %}

